<app-header></app-header>

<div class="catalog-container">
  <main class="catalog-content">
    <div class="catalog-header">
      <h1>Catalogue</h1>
    </div>

    <!-- Catégories en haut -->
    <app-categories-list
      [categories]="categories()"
      [selectedCategoryId]="selectedCategoryId()"
      (categorySelected)="selectCategory($event)">
    </app-categories-list>

    <!-- Bouton et Dropdown des filtres -->
    <div class="filters-dropdown-wrapper">
      <button mat-raised-button color="primary" (click)="toggleFilters()" class="filters-toggle-btn">
        <span>{{ showFilters() ? '✕ Masquer' : '⚙️ Filtres' }}</span>
      </button>

      @if (showFilters()) {
        <div class="filters-dropdown-content">
          <app-category-filter
            [collections]="collections()"
            [allProducts]="allProducts()"
            [selectedPiecesFilter]="selectedPiecesFilter()"
            [selectedCollectionFilter]="selectedCollectionFilter()"
            [priceRange]="priceRange()"
            [useLotPrice]="useLotPrice()"
            [selectedIngredients]="selectedIngredients()"
            [excludedAllergenes]="excludedAllergenes()"
            (piecesFilterChanged)="selectedPiecesFilter.set($event)"
            (collectionFilterChanged)="selectedCollectionFilter.set($event)"
            (priceRangeChanged)="priceRange.set($event)"
            (useLotPriceChanged)="useLotPrice.set($event)"
            (ingredientToggled)="toggleIngredient($event)"
            (allergeneToggled)="toggleAllergene($event)"
            (filtersReset)="resetFilters()">
          </app-category-filter>
        </div>
      }
    </div>

    <div class="catalog-layout">
      <!-- Titre de la catégorie sélectionnée -->
      @if (selectedCategory(); as category) {
        <h2 class="selected-category-title">{{ category.titre }}</h2>
      } @else {
        <h2 class="selected-category-title">Tous nos produits</h2>
      }

      <!-- Grille de produits -->
      <div class="products-grid">
        @if (filteredProducts().length > 0) {
          @for (product of filteredProducts(); track product.reference_produit) {
            <app-product-card
              [product]="product"
              (addToCartClicked)="addToCart($event)">
            </app-product-card>
          }
        } @else {
          <div class="no-products">
            <p>Aucun produit ne correspond à vos filtres.</p>
          </div>
        }
      </div>

      <!-- Nombre de résultats -->
      <div class="results-info">
        {{ filteredProducts().length }} produit(s) trouvé(s)
      </div>
    </div>
  </main>
</div>
<app-footer></app-footer>