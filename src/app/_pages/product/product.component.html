<app-header></app-header>

<div class="p-8 max-w-5xl mx-auto min-h-96 bg-gradient-to-br from-white via-slate-50 to-blue-50">
  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center gap-4 min-h-screen text-center">
      <mat-icon class="text-6xl text-gray-400">hourglass_empty</mat-icon>
      <p>Chargement du produit...</p>
    </div>
  }

  @if (error()) {
    <div class="flex flex-col items-center justify-center gap-4 min-h-96 text-center text-red-600">
      <mat-icon class="text-6xl">error_outline</mat-icon>
      <p>{{ error() }}</p>
      <button mat-raised-button color="primary" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour au catalogue
      </button>
    </div>
  }

  @if (product()) {
    <div class="relative">
      <!-- Bouton retour -->
      <button mat-icon-button class="text-gray-600 mb-4" (click)="goBack()" title="Retour">
        <mat-icon>arrow_back</mat-icon>
      </button>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mb-12">
        <!-- Image principale -->
        <div class="flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl overflow-hidden shadow-xl">
          <img 
            [src]="'/assets/img/produits/' + product()!.reference_image"
            [alt]="product()!.nom"
            class="w-full h-auto object-contain"
            onerror="this.src='/assets/img/produits/placeholder.png'"
          />
        </div>

        <!-- Infos produit -->
        <div class="flex flex-col gap-6">
          <!-- Référence -->
          <div class="text-sm text-gray-600">
            Réf: {{ product()!.reference_produit }}
          </div>

          <!-- Titre -->
          <h1 class="text-5xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">{{ product()!.nom }}</h1>

          <!-- Pièces -->
          <div class="flex items-center gap-2 text-gray-700">
            <mat-icon>dashboard</mat-icon>
            <span>{{ product()!.nombre_pieces }} pièces</span>
          </div>

          <!-- Description -->
          <div>
            <h3 class="text-lg font-semibold mb-2">Description</h3>
            <p class="text-gray-700">{{ product()!.description }}</p>
          </div>

          <!-- Ingrédients -->
          @if (product()!.ingredients.length > 0) {
            <div>
              <h3 class="text-lg font-semibold mb-2">Ingrédients</h3>
              <ul class="list-disc list-inside text-gray-700">
                @for (ingredient of product()!.ingredients; track ingredient) {
                  <li>{{ ingredient }}</li>
                }
              </ul>
            </div>
          }

          <!-- Allergènes -->
          <div>
            @if (product()!.allergenes.length > 0) {
              <h3 class="text-lg font-semibold mb-2">⚠️ Allergènes</h3>
              <div class="flex flex-wrap gap-2">
                @for (allergene of product()!.allergenes; track allergene) {
                  <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm font-medium">{{ allergene }}</span>
                }
              </div>
            } @else {
              <p class="text-gray-600">Pas d'allergènes</p>
            }
          </div>

          <!-- Prix -->
          <div class="border-t-2 border-gradient-to-r from-indigo-300 to-purple-300 pt-6 bg-gradient-to-br from-indigo-50 to-purple-50 p-4 rounded-xl">
            <div class="flex justify-between mb-4">
              <span class="text-gray-700 font-semibold">Prix au lot:</span>
              <span class="text-3xl font-bold bg-gradient-to-r from-green-500 to-emerald-600 bg-clip-text text-transparent">{{ product()!.prix_lot | currency: 'EUR': 'symbol': '1.2-2' }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-700 font-semibold">Prix unitaire:</span>
              <span class="text-lg font-bold text-gray-700">{{ product()!.prix_unitaire | currency: 'EUR': 'symbol': '1.2-2' }}<span class="text-sm font-normal">/pce</span></span>
            </div>
          </div>

          <!-- Bouton ajouter au panier -->
          <button mat-raised-button color="primary" class="w-full py-3 text-lg font-semibold mt-4" (click)="addToCart()">
            <mat-icon>add_shopping_cart</mat-icon>
            Ajouter au panier
          </button>
        </div>
      </div>

      <!-- Informations nutritionnelles -->
      @if (product()!.informations_nutritionnelles && product()!.informations_nutritionnelles.lien_pdf) {
        <div class="p-6 bg-gray-50 rounded-lg">
          <h3 class="text-lg font-semibold mb-3">Informations nutritionnelles</h3>
          <a [href]="product()!.informations_nutritionnelles.lien_pdf" target="_blank" class="flex items-center gap-2 text-blue-600 hover:underline font-medium">
            <mat-icon>picture_as_pdf</mat-icon>
            Voir le PDF
          </a>
        </div>
      }
    </div>
  }
</div>

<app-footer></app-footer>
